<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>face detection</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    {% load staticfiles %}
    <script type="text/javascript" src="{% static 'demo/js/tracking-min.js' %}"></script>
    <script type="text/javascript" src="{% static 'demo/js/ccv.js' %}"></script>
    <script type="text/javascript" src="{% static 'demo/js/face_glasses.js' %}"></script>
    <!--<script type="text/javascript" src="{% static 'demo/js/jquery.facedetection.min.js' %}"></script>-->
  </head>
  <body>

    <div class="container">
      {% load staticfiles %}
      <video  class="embed-responsive-item" controls height="426" width="640" >
      <source src="{% static 'demo/training.mp4' %}" width="50%" type="video/mp4">
      <source src="movie.ogg" type="video/ogg">
      Your browser does not support the video tag.
      </video>


    Out Canvas Element for output
  	<canvas id="output"  height="426" width="640" ></canvas>
    </div>
  	<!--div to track progress-->
  	<div id="elapsed_time">Press play for HTML5 Glasses!</div>
    <script type="text/javascript">
      /*var objects = new tracking.ObjectTracker("face");
      // Fires when faces are found on the image.
      objects.on('track', function(event) {
      if (event.data.length === 0) {
        // No objects were detected in this frame.
      } else {
        event.data.forEach(function(rect) {
          //console.log(rect.x, rect.y, rect.height, rect.width, rect.color);

          plotRectangle(objects,rect);
        });
      }
      });
      function plotRectangle(el, rect) {
        var div = document.createElement('div');
        div.style.position = 'absolute';
        div.style.zIndex = '999';
        div.style.border = '2px solid ' + (rect.color || 'magenta');
        div.style.width = rect.width + 'px';
        div.style.height = rect.height + 'px';
        div.style.left = el.offsetLeft + rect.x + 'px';
        div.style.top = el.offsetTop + rect.y + 'px';
        document.body.appendChild(div);
        return div;
      }
      tracking.track('#myvideo',objects);
      /*$('#myvideo').faceDetection({
        complete: function (faces) {
            console.log(faces);
        }
        error: function (code, message) {
            console.error();
        }
    });*/
    var
		// Store the first HTML5 video element in the document
		video = document.querySelector('video'),
		// We use this to time how long things are taking. Not that important..
		time_dump = document.getElementById("elapsed_time"),
		// Create a new image that will be our goofy glasses
		glasses = new Image(),
		// Store the canvas so we can write to it
		canvas = document.getElementById("output"),
		// Get the canvas 2d Context
		ctx = canvas.getContext("2d");
		// Finally set the source of our new glasses img element
		glasses.src = "{% static 'demo/glasses.png' %}";

    function html5glasses() {
	// Start the clock
    	var elapsed_time = (new Date()).getTime();

    	// Draw the video to canvas
    	ctx.drawImage(video, 0, 0, video.width, video.height, 0, 0, canvas.width, canvas.height);

    	// use the face detection library to find the face
    	var comp = ccv.detect_objects({ "canvas" : (ccv.pre(canvas)),
    									"cascade" : cascade,
    									"interval" : 5,
    									"min_neighbors" : 1 });

    	// Stop the clock
    	time_dump.innerHTML = "Process time : " + ((new Date()).getTime() - elapsed_time).toString() + "ms";

    	// Draw glasses on everyone!
    	for (var i = 0; i < comp.length; i++) {
    		ctx.drawImage(glasses, comp[i].x, comp[i].y,comp[i].width, comp[i].height);
    	}
    }
    video.addEventListener('play', function() {
    	vidInterval = setInterval(html5glasses,200);
    });

    video.addEventListener('ended', function() {
    	clearInterval(vidInterval);
    	time_dump.innerHTML = "finished";
    });
    </script>
  </body>
</html>
